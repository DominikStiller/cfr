

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>A Pseudoproxy Experiment with GraphEM and pseudoPAGES2k &#8212; cfr  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script src="../_static/design-tabs.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/graphem-ppe-pages2k-debug';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/favicon.ico" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/favicon.ico" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../ug-installation.html">Installation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ug-pp2k.html">Illustration: pseudoPAGES2k</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="pp2k-pdb-load-viz.html">Loading and Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="pp2k-pdb-filter.html">Database Filtering</a></li>
<li class="toctree-l2"><a class="reference internal" href="pp2k-dashboards.html">Validation Dashboards</a></li>
<li class="toctree-l2"><a class="reference internal" href="pp2k-ppe-pda.html">PPE: A PDA-based Reconstruction</a></li>
<li class="toctree-l2"><a class="reference internal" href="pp2k-ppe-graphem.html">PPE: A GraphEM-based Reconstruction</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ug-climate.html">Climate</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="climate-io.html">Input/Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="climate-ops.html">Basic Operations</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ug-proxy.html">Proxy</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="proxy-io.html">Input/Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="proxy-ops.html">Basic Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="proxy-analysis.html">Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="proxy-composites.html">Composites</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ug-psm.html">PSM</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="psm-linear.html">Univariate linear regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="psm-bilinear.html">Bivariate linear regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="psm-ice-d18O.html">PSM for ice core d18O</a></li>
<li class="toctree-l2"><a class="reference internal" href="psm-lake-VarveThickness.html">PSM for lake varve thickness</a></li>
<li class="toctree-l2"><a class="reference internal" href="psm-coral-SrCa.html">PSM for coral Sr/Ca</a></li>
<li class="toctree-l2"><a class="reference internal" href="psm-coral-d18O.html">PSM for coral d18O</a></li>
<li class="toctree-l2"><a class="reference internal" href="psm-tree-TRW.html">PSM for tree TRW (VS-Lite)</a></li>
<li class="toctree-l2"><a class="reference internal" href="psm-tree-seasonality.html">Detecting the seasonality of the trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="psm-tree-memory.html">Detecting the biological memory in the trees</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ug-lmr.html">LMR</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="lmr-real-pages2k.html">Real-world proxy experiments with LMR and PAGES2k</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ug-graphem.html">GraphEM</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="graphem-real-pages2k.html">Real-world proxy experiments with GraphEM and PAGES2k</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ug-api.html">API Reference</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/fzhu2e/cfr" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/fzhu2e/cfr/edit/main/notebooks/graphem-ppe-pages2k-debug.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/fzhu2e/cfr/issues/new?title=Issue%20on%20page%20%2Fnotebooks/graphem-ppe-pages2k-debug.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/graphem-ppe-pages2k-debug.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>A Pseudoproxy Experiment with GraphEM and pseudoPAGES2k</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">A Pseudoproxy Experiment with GraphEM and pseudoPAGES2k</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Data-Preparation">Data Preparation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Graph-estimation">Graph estimation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#1.-Neighborhood-graph-as-initial-guess">1. Neighborhood graph as initial guess</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Preliminary-reconstruction">Preliminary reconstruction</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#Bug-Hunting">Bug Hunting</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="A-Pseudoproxy-Experiment-with-GraphEM-and-pseudoPAGES2k">
<h1>A Pseudoproxy Experiment with GraphEM and pseudoPAGES2k<a class="headerlink" href="#A-Pseudoproxy-Experiment-with-GraphEM-and-pseudoPAGES2k" title="Permalink to this heading">#</a></h1>
<p><strong>Expected time to run through: TBD mins</strong></p>
<p>This tutorial demonstrates how to get a reconstruction using GraphEM, leveraging a simple pseudoproxy dataset generated from iCESM gridded, with the realistic spatial availability but full temporal availablity of the PAGES 2k version 2 dataset. The pseudoproxies are generated based on the original iCESM simulated surface temperature (<code class="docutils literal notranslate"><span class="pre">tas</span></code>) plus white noise with <code class="docutils literal notranslate"><span class="pre">SNR=10</span></code>. While with LMR it is advantageous to have many redundant proxies (as long as they are unbiased, which is the case here),
with GraphEM this can lead to some counter-intuitive difficulties, which we explain below.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2

<span class="kn">import</span> <span class="nn">cfr</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span>  <span class="nn">plt</span>
</pre></div>
</div>
</div>
<section id="Data-Preparation">
<h2>Data Preparation<a class="headerlink" href="#Data-Preparation" title="Permalink to this heading">#</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load a proxy database</span>
<span class="n">job</span> <span class="o">=</span> <span class="n">cfr</span><span class="o">.</span><span class="n">ReconJob</span><span class="p">()</span>
<span class="n">job</span><span class="o">.</span><span class="n">proxydb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s1">&#39;./data/pseudoPAGES2k/pseudo.tpn_SNR10.pkl&#39;</span><span class="p">)</span>
<span class="n">job</span><span class="o">.</span><span class="n">proxydb</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&lt;Figure size 720x720 with 1 Axes&gt;, {&#39;map&#39;: &lt;GeoAxesSubplot:&gt;})
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_graphem-ppe-pages2k-debug_4_1.png" src="../_images/notebooks_graphem-ppe-pages2k-debug_4_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># filter the database</span>
<span class="c1">#job.proxydb = job.proxydb.filter(by=&#39;loc-square&#39;, keys=(-30, 30, 30, 250))</span>
<span class="c1">#fig, ax = job.proxydb.plot()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># filter the database</span>
<span class="n">job</span><span class="o">.</span><span class="n">proxydb</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">proxydb</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;ptype&#39;</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="s1">&#39;coral&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">proxydb</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_graphem-ppe-pages2k-debug_6_0.png" src="../_images/notebooks_graphem-ppe-pages2k-debug_6_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job</span><span class="o">.</span><span class="n">proxydb</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">proxydb</span><span class="o">.</span><span class="n">center</span><span class="p">([</span><span class="mi">1951</span><span class="p">,</span> <span class="mi">1980</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Centering each of the ProxyRecord: 100%|█████████████████████████████████████████████████████████████████████████████████████| 104/104 [00:00&lt;00:00, 3652.23it/s]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[73]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job</span><span class="o">.</span><span class="n">proxydb</span><span class="o">.</span><span class="n">records</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[73]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dict_keys([&#39;Ocn_065&#39;, &#39;Ocn_075&#39;, &#39;Ocn_078&#39;, &#39;Ocn_167&#39;, &#39;Ocn_091&#39;, &#39;Ocn_093&#39;, &#39;Ocn_096&#39;, &#39;Ocn_086&#39;, &#39;Ocn_101&#39;, &#39;Ocn_070&#39;, &#39;Ocn_076&#39;, &#39;Ocn_099&#39;, &#39;Ocn_144&#39;, &#39;Ocn_178&#39;, &#39;Ocn_158&#39;, &#39;Ocn_149&#39;, &#39;Ocn_150&#39;, &#39;Ocn_177&#39;, &#39;Ocn_080&#39;, &#39;Ocn_171&#39;, &#39;Ocn_108&#39;, &#39;Ocn_103&#39;, &#39;Ocn_068&#39;, &#39;Ocn_069&#39;, &#39;Ocn_145&#39;, &#39;Ocn_098&#39;, &#39;Ocn_151&#39;, &#39;Ocn_152&#39;, &#39;Ocn_115&#39;, &#39;Ocn_170&#39;, &#39;Ocn_180&#39;, &#39;Ocn_154&#39;, &#39;Ocn_155&#39;, &#39;Ocn_111&#39;, &#39;Ocn_112&#39;, &#39;Ocn_116&#39;, &#39;Ocn_130&#39;, &#39;Ocn_131&#39;, &#39;Ocn_147&#39;, &#39;Ocn_106&#39;, &#39;Ocn_174&#39;, &#39;Ocn_077&#39;, &#39;Ocn_083&#39;, &#39;Ocn_160&#39;, &#39;Ocn_172&#39;, &#39;Ocn_060&#39;, &#39;Ocn_122&#39;, &#39;Ocn_166&#39;, &#39;Ocn_123&#39;, &#39;Ocn_140&#39;, &#39;Ocn_141&#39;, &#39;Ocn_164&#39;, &#39;Ocn_165&#39;, &#39;Ocn_179&#39;, &#39;Ocn_082&#39;, &#39;Ocn_066&#39;, &#39;Ocn_067&#39;, &#39;Ocn_138&#39;, &#39;Ocn_168&#39;, &#39;Ocn_142&#39;, &#39;Ocn_143&#39;, &#39;Ocn_088&#39;, &#39;Ocn_129&#39;, &#39;Ocn_110&#39;, &#39;Ocn_084&#39;, &#39;Ocn_073&#39;, &#39;Ocn_114&#39;, &#39;Ocn_081&#39;, &#39;Ocn_175&#39;, &#39;Ocn_176&#39;, &#39;Ocn_120&#39;, &#39;Ocn_121&#39;, &#39;Ocn_127&#39;, &#39;Ocn_128&#39;, &#39;Ocn_074&#39;, &#39;Ocn_183&#39;, &#39;Ocn_173&#39;, &#39;Ocn_118&#39;, &#39;Ocn_139&#39;, &#39;Ocn_061&#39;, &#39;Ocn_062&#39;, &#39;Ocn_079&#39;, &#39;Ocn_095&#39;, &#39;Ocn_156&#39;, &#39;Ocn_104&#39;, &#39;Ocn_107&#39;, &#39;Ocn_157&#39;, &#39;Ocn_146&#39;, &#39;Ocn_181&#39;, &#39;Ocn_182&#39;, &#39;Ocn_162&#39;, &#39;Ocn_163&#39;, &#39;Ocn_161&#39;, &#39;Ocn_125&#39;, &#39;Ocn_090&#39;, &#39;Ocn_119&#39;, &#39;Ocn_109&#39;, &#39;Ocn_097&#39;, &#39;Ocn_159&#39;, &#39;Ocn_087&#39;, &#39;Ocn_153&#39;, &#39;Ocn_169&#39;, &#39;Ocn_071&#39;, &#39;Ocn_072&#39;])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[75]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Ocn_065&#39;</span><span class="p">,</span> <span class="s1">&#39;Ocn_075&#39;</span><span class="p">,</span> <span class="s1">&#39;Ocn_078&#39;</span><span class="p">]</span> <span class="c1"># Question for Feng: how to automatically loop over proxydb items?</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
    <span class="n">rec</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">proxydb</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="n">rec</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
850.0 2005.0
850.0 2005.0
850.0 2005.0
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_graphem-ppe-pages2k-debug_9_1.png" src="../_images/notebooks_graphem-ppe-pages2k-debug_9_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_graphem-ppe-pages2k-debug_9_2.png" src="../_images/notebooks_graphem-ppe-pages2k-debug_9_2.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_graphem-ppe-pages2k-debug_9_3.png" src="../_images/notebooks_graphem-ppe-pages2k-debug_9_3.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load observations</span>
<span class="n">job</span><span class="o">.</span><span class="n">load_clim</span><span class="p">(</span>
    <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;obs&#39;</span><span class="p">,</span>
    <span class="n">path_dict</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;tas&#39;</span><span class="p">:</span> <span class="s1">&#39;./data/tas_sfc_Amon_iCESM_past1000historical_085001-200512.nc&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">anom_period</span><span class="o">=</span><span class="p">(</span><span class="mi">1951</span><span class="p">,</span> <span class="mi">1980</span><span class="p">),</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-cyan-intense-fg ansi-bold">&gt;&gt;&gt; job.configs[&#34;obs_path&#34;] = {&#39;tas&#39;: &#39;./data/tas_sfc_Amon_iCESM_past1000historical_085001-200512.nc&#39;}</span>
<span class="ansi-cyan-intense-fg ansi-bold">&gt;&gt;&gt; job.configs[&#34;obs_anom_period&#34;] = (1951, 1980)</span>
<span class="ansi-green-intense-fg ansi-bold">&gt;&gt;&gt; obs variables [&#39;tas&#39;] loaded</span>
<span class="ansi-green-intense-fg ansi-bold">&gt;&gt;&gt; job.obs created</span>
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># regrid and crop obs to make the problem size smaller</span>
<span class="n">job</span><span class="o">.</span><span class="n">regrid_clim</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s1">&#39;obs&#39;</span><span class="p">,</span> <span class="n">nlat</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">nlon</span><span class="o">=</span><span class="mi">63</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">#job.regrid_clim(tag=&#39;obs&#39;, nlat=32, nlon=50, verbose=True)</span>
<span class="n">job</span><span class="o">.</span><span class="n">crop_clim</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s1">&#39;obs&#39;</span><span class="p">,</span> <span class="n">lat_min</span><span class="o">=-</span><span class="mi">25</span><span class="p">,</span> <span class="n">lat_max</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">lon_min</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">lon_max</span><span class="o">=</span><span class="mi">280</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-cyan-intense-fg ansi-bold">&gt;&gt;&gt; job.configs[&#34;prior_regrid_nlat&#34;] = 42</span>
<span class="ansi-cyan-intense-fg ansi-bold">&gt;&gt;&gt; job.configs[&#34;prior_regrid_nlon&#34;] = 63</span>
<span class="ansi-cyan-intense-fg ansi-bold">&gt;&gt;&gt; Processing tas ...</span>
<span class="ansi-cyan-intense-fg ansi-bold">&gt;&gt;&gt; job.configs[&#34;prior_lat_min&#34;] = -25</span>
<span class="ansi-cyan-intense-fg ansi-bold">&gt;&gt;&gt; job.configs[&#34;prior_lat_max&#34;] = 25</span>
<span class="ansi-cyan-intense-fg ansi-bold">&gt;&gt;&gt; job.configs[&#34;prior_lon_min&#34;] = 120</span>
<span class="ansi-cyan-intense-fg ansi-bold">&gt;&gt;&gt; job.configs[&#34;prior_lon_max&#34;] = 280</span>
<span class="ansi-cyan-intense-fg ansi-bold">&gt;&gt;&gt; Processing tas ...</span>
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># annualize the observations</span>
<span class="n">job</span><span class="o">.</span><span class="n">annualize_clim</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s1">&#39;obs&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">months</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)))</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">it</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-cyan-intense-fg ansi-bold">&gt;&gt;&gt; job.configs[&#34;prior_annualize_months&#34;] = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]</span>
<span class="ansi-cyan-intense-fg ansi-bold">&gt;&gt;&gt; Processing tas ...</span>
<span class="ansi-green-intense-fg ansi-bold">&gt;&gt;&gt; job.obs updated</span>
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_graphem-ppe-pages2k-debug_12_1.png" src="../_images/notebooks_graphem-ppe-pages2k-debug_12_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">da</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;tas&#x27; (year: 1156, lat: 12, lon: 28)&gt;
array([[[-1.43779302, -1.16293697, -1.01732908, ...,  0.39457998,
          0.52082612,  0.59373487],
        [-0.44181921, -0.51548275,  0.244261  , ...,  0.74474864,
          0.77145844,  0.68355714],
        [ 0.35079578,  0.32100882,  0.55368277, ...,  0.88217642,
          0.68757142,  0.31475473],
        ...,
        [ 0.72816369,  0.71887253,  0.54529944, ...,  0.20676015,
          0.30845679,  0.2907033 ],
        [ 1.10758701,  0.98782858,  1.00810014, ...,  0.09055938,
          0.18384386,  0.24694595],
        [ 1.31631178,  1.20505177,  1.04198581, ...,  0.14300547,
          0.29674634,  0.27620213]],

       [[-0.70474708, -0.01598469,  0.13178037, ..., -0.16622394,
         -0.03184134, -0.0226782 ],
        [-0.47576783, -0.55773132, -0.46185074, ..., -0.03219556,
          0.01012642,  0.01045555],
        [ 0.10615215, -0.04668079, -0.21236786, ...,  0.06428793,
         -0.00198371, -0.03837104],
...
        [ 0.25181528,  0.44903654,  0.61978375, ...,  0.31308888,
          0.36723991,  0.52567691],
        [ 0.04978446,  0.04787485,  0.22568625, ...,  0.45198041,
          0.4664865 ,  0.49749394],
        [ 0.10458478, -0.10605026, -0.21279729, ...,  0.54345012,
          0.54446683,  0.52080011]],

       [[ 0.0498074 ,  0.27873075,  0.39957376, ..., -0.03960866,
         -0.05272122,  0.16753688],
        [-0.37810031,  0.30122609, -0.0628949 , ..., -0.11026585,
          0.06519481,  0.26313251],
        [ 0.08783609, -0.448483  , -0.12010821, ..., -0.0352111 ,
          0.10163381,  0.12676614],
        ...,
        [ 0.09630422,  0.35422082,  0.39387372, ...,  0.24968949,
          0.3645677 ,  0.26936438],
        [-0.06625534,  0.26004941,  0.47504105, ...,  0.32676493,
          0.46907017,  0.4533393 ],
        [-0.19586628,  0.12946299,  0.54914526, ...,  0.38060853,
          0.41296104,  0.51346773]]])
Coordinates:
  * year     (year) int64 850 851 852 853 854 855 ... 2001 2002 2003 2004 2005
  * lon      (lon) float64 121.9 127.7 133.5 139.4 ... 261.3 267.1 272.9 278.7
  * lat      (lat) float64 -24.15 -19.76 -15.37 -10.98 ... 15.37 19.76 24.15</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'tas'</div><ul class='xr-dim-list'><li><span class='xr-has-index'>year</span>: 1156</li><li><span class='xr-has-index'>lat</span>: 12</li><li><span class='xr-has-index'>lon</span>: 28</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-1c89114a-f278-446c-9ae1-e5b60528eac3' class='xr-array-in' type='checkbox' checked><label for='section-1c89114a-f278-446c-9ae1-e5b60528eac3' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>-1.438 -1.163 -1.017 -0.9146 -0.9414 ... 0.6372 0.3806 0.413 0.5135</span></div><div class='xr-array-data'><pre>array([[[-1.43779302, -1.16293697, -1.01732908, ...,  0.39457998,
          0.52082612,  0.59373487],
        [-0.44181921, -0.51548275,  0.244261  , ...,  0.74474864,
          0.77145844,  0.68355714],
        [ 0.35079578,  0.32100882,  0.55368277, ...,  0.88217642,
          0.68757142,  0.31475473],
        ...,
        [ 0.72816369,  0.71887253,  0.54529944, ...,  0.20676015,
          0.30845679,  0.2907033 ],
        [ 1.10758701,  0.98782858,  1.00810014, ...,  0.09055938,
          0.18384386,  0.24694595],
        [ 1.31631178,  1.20505177,  1.04198581, ...,  0.14300547,
          0.29674634,  0.27620213]],

       [[-0.70474708, -0.01598469,  0.13178037, ..., -0.16622394,
         -0.03184134, -0.0226782 ],
        [-0.47576783, -0.55773132, -0.46185074, ..., -0.03219556,
          0.01012642,  0.01045555],
        [ 0.10615215, -0.04668079, -0.21236786, ...,  0.06428793,
         -0.00198371, -0.03837104],
...
        [ 0.25181528,  0.44903654,  0.61978375, ...,  0.31308888,
          0.36723991,  0.52567691],
        [ 0.04978446,  0.04787485,  0.22568625, ...,  0.45198041,
          0.4664865 ,  0.49749394],
        [ 0.10458478, -0.10605026, -0.21279729, ...,  0.54345012,
          0.54446683,  0.52080011]],

       [[ 0.0498074 ,  0.27873075,  0.39957376, ..., -0.03960866,
         -0.05272122,  0.16753688],
        [-0.37810031,  0.30122609, -0.0628949 , ..., -0.11026585,
          0.06519481,  0.26313251],
        [ 0.08783609, -0.448483  , -0.12010821, ..., -0.0352111 ,
          0.10163381,  0.12676614],
        ...,
        [ 0.09630422,  0.35422082,  0.39387372, ...,  0.24968949,
          0.3645677 ,  0.26936438],
        [-0.06625534,  0.26004941,  0.47504105, ...,  0.32676493,
          0.46907017,  0.4533393 ],
        [-0.19586628,  0.12946299,  0.54914526, ...,  0.38060853,
          0.41296104,  0.51346773]]])</pre></div></div></li><li class='xr-section-item'><input id='section-d0003caf-0859-4a29-b15e-97d8ee0ecf97' class='xr-section-summary-in' type='checkbox'  checked><label for='section-d0003caf-0859-4a29-b15e-97d8ee0ecf97' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>year</span></div><div class='xr-var-dims'>(year)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>850 851 852 853 ... 2003 2004 2005</div><input id='attrs-8b4fac6a-538d-4215-b5bd-9228611328fd' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-8b4fac6a-538d-4215-b5bd-9228611328fd' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4aa8e1d9-9b62-4028-a106-eaa1d80c21ba' class='xr-var-data-in' type='checkbox'><label for='data-4aa8e1d9-9b62-4028-a106-eaa1d80c21ba' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ 850,  851,  852, ..., 2003, 2004, 2005])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lon</span></div><div class='xr-var-dims'>(lon)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>121.9 127.7 133.5 ... 272.9 278.7</div><input id='attrs-5adb5d38-3264-4c7a-9044-82c8944cc187' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-5adb5d38-3264-4c7a-9044-82c8944cc187' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4abca520-25db-4b04-a615-7b54ecfe5f21' class='xr-var-data-in' type='checkbox'><label for='data-4abca520-25db-4b04-a615-7b54ecfe5f21' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([121.935484, 127.741935, 133.548387, 139.354839, 145.16129 , 150.967742,
       156.774194, 162.580645, 168.387097, 174.193548, 180.      , 185.806452,
       191.612903, 197.419355, 203.225806, 209.032258, 214.83871 , 220.645161,
       226.451613, 232.258065, 238.064516, 243.870968, 249.677419, 255.483871,
       261.290323, 267.096774, 272.903226, 278.709677])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lat</span></div><div class='xr-var-dims'>(lat)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-24.15 -19.76 ... 19.76 24.15</div><input id='attrs-25eeb8f4-de52-4695-9e89-76518835225f' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-25eeb8f4-de52-4695-9e89-76518835225f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5a6bb6e5-25a5-4ed4-aa10-c6c918322fe4' class='xr-var-data-in' type='checkbox'><label for='data-5a6bb6e5-25a5-4ed4-aa10-c6c918322fe4' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([-24.146341, -19.756098, -15.365854, -10.97561 ,  -6.585366,  -2.195122,
         2.195122,   6.585366,  10.97561 ,  15.365854,  19.756098,  24.146341])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-c1c5a798-016c-4a93-845c-2d20055547b5' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-c1c5a798-016c-4a93-845c-2d20055547b5' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div>
</div>
<p>The method <code class="docutils literal notranslate"><span class="pre">prep_graphem()</span></code> helps weave everything into an object that the code can work with:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job</span><span class="o">.</span><span class="n">prep_graphem</span><span class="p">(</span>
    <span class="n">recon_period</span><span class="o">=</span><span class="p">(</span><span class="mi">1001</span><span class="p">,</span> <span class="mi">2000</span><span class="p">),</span>
    <span class="n">calib_period</span><span class="o">=</span><span class="p">(</span><span class="mi">1850</span><span class="p">,</span> <span class="mi">2000</span><span class="p">),</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-green-intense-fg ansi-bold">&gt;&gt;&gt; job.recon_time created</span>
<span class="ansi-green-intense-fg ansi-bold">&gt;&gt;&gt; job.calib_time created</span>
<span class="ansi-green-intense-fg ansi-bold">&gt;&gt;&gt; job.calib_idx created</span>
<span class="ansi-green-intense-fg ansi-bold">&gt;&gt;&gt; job.temp created</span>
<span class="ansi-green-intense-fg ansi-bold">&gt;&gt;&gt; job.df_proxy created</span>
<span class="ansi-green-intense-fg ansi-bold">&gt;&gt;&gt; job.proxy created</span>
<span class="ansi-green-intense-fg ansi-bold">&gt;&gt;&gt; job.lonlat created</span>
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job</span><span class="o">.</span><span class="n">temp</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[       nan,        nan,        nan, ...,        nan,        nan,
               nan],
       [       nan,        nan,        nan, ...,        nan,        nan,
               nan],
       [       nan,        nan,        nan, ...,        nan,        nan,
               nan],
       ...,
       [0.70970161, 0.73450522, 0.30319882, ..., 0.34267614, 0.25509715,
        0.39273508],
       [0.57543254, 0.4847614 , 0.17716476, ..., 0.26505406, 0.25998264,
        0.37178005],
       [0.66133266, 0.97367383, 1.02246066, ..., 0.0466115 , 0.12031657,
        0.13679344]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job</span><span class="o">.</span><span class="n">df_proxy</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Ocn_065</th>
      <th>Ocn_075</th>
      <th>Ocn_078</th>
      <th>Ocn_167</th>
      <th>Ocn_091</th>
      <th>Ocn_093</th>
      <th>Ocn_096</th>
      <th>Ocn_086</th>
      <th>Ocn_101</th>
      <th>Ocn_070</th>
      <th>...</th>
      <th>Ocn_090</th>
      <th>Ocn_119</th>
      <th>Ocn_109</th>
      <th>Ocn_097</th>
      <th>Ocn_159</th>
      <th>Ocn_087</th>
      <th>Ocn_153</th>
      <th>Ocn_169</th>
      <th>Ocn_071</th>
      <th>Ocn_072</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1001.0</th>
      <td>-0.137829</td>
      <td>-0.205720</td>
      <td>-0.647684</td>
      <td>0.898822</td>
      <td>-0.356257</td>
      <td>-0.356257</td>
      <td>0.425059</td>
      <td>0.029546</td>
      <td>-0.185165</td>
      <td>-0.362198</td>
      <td>...</td>
      <td>-0.288019</td>
      <td>-0.756506</td>
      <td>-0.157369</td>
      <td>-0.288019</td>
      <td>-0.756506</td>
      <td>-0.636890</td>
      <td>-0.348730</td>
      <td>-0.332147</td>
      <td>-0.395720</td>
      <td>-0.395720</td>
    </tr>
    <tr>
      <th>1002.0</th>
      <td>-0.376911</td>
      <td>-0.380234</td>
      <td>-0.836313</td>
      <td>-0.215733</td>
      <td>-0.488090</td>
      <td>-0.488090</td>
      <td>-0.455390</td>
      <td>-0.366285</td>
      <td>-0.751944</td>
      <td>-0.417541</td>
      <td>...</td>
      <td>-0.892699</td>
      <td>-0.212252</td>
      <td>-0.503061</td>
      <td>-0.892699</td>
      <td>-0.212252</td>
      <td>0.603636</td>
      <td>-0.293169</td>
      <td>-0.315477</td>
      <td>-0.374382</td>
      <td>-0.374382</td>
    </tr>
    <tr>
      <th>1003.0</th>
      <td>-0.074143</td>
      <td>0.186897</td>
      <td>0.083945</td>
      <td>0.439043</td>
      <td>-0.002832</td>
      <td>-0.002832</td>
      <td>-0.364133</td>
      <td>-0.243331</td>
      <td>-0.202119</td>
      <td>-0.170308</td>
      <td>...</td>
      <td>-0.144198</td>
      <td>-0.067308</td>
      <td>-0.028223</td>
      <td>-0.144198</td>
      <td>-0.067308</td>
      <td>-0.067106</td>
      <td>0.440870</td>
      <td>0.147798</td>
      <td>0.223871</td>
      <td>0.223871</td>
    </tr>
    <tr>
      <th>1004.0</th>
      <td>-0.396937</td>
      <td>-0.023028</td>
      <td>-0.026614</td>
      <td>0.381423</td>
      <td>0.060887</td>
      <td>0.060887</td>
      <td>0.255347</td>
      <td>0.171702</td>
      <td>0.404180</td>
      <td>-0.329291</td>
      <td>...</td>
      <td>0.120833</td>
      <td>-0.416455</td>
      <td>0.350750</td>
      <td>0.120833</td>
      <td>-0.416455</td>
      <td>-0.355235</td>
      <td>-0.066871</td>
      <td>-0.152709</td>
      <td>-0.159114</td>
      <td>-0.159114</td>
    </tr>
    <tr>
      <th>1005.0</th>
      <td>0.189849</td>
      <td>-0.203502</td>
      <td>-0.267335</td>
      <td>0.186128</td>
      <td>0.080553</td>
      <td>0.080553</td>
      <td>-0.190592</td>
      <td>-0.152617</td>
      <td>-0.247644</td>
      <td>0.045527</td>
      <td>...</td>
      <td>-0.126214</td>
      <td>-0.461959</td>
      <td>0.005048</td>
      <td>-0.126214</td>
      <td>-0.461959</td>
      <td>-0.654685</td>
      <td>-0.108365</td>
      <td>-0.336745</td>
      <td>-0.441364</td>
      <td>-0.441364</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1996.0</th>
      <td>0.711621</td>
      <td>0.291426</td>
      <td>0.632199</td>
      <td>0.143895</td>
      <td>-0.054895</td>
      <td>-0.054895</td>
      <td>-0.664192</td>
      <td>-0.030944</td>
      <td>0.308333</td>
      <td>0.722785</td>
      <td>...</td>
      <td>0.268700</td>
      <td>0.497055</td>
      <td>-0.424533</td>
      <td>0.268700</td>
      <td>0.497055</td>
      <td>0.247637</td>
      <td>0.888607</td>
      <td>0.429088</td>
      <td>0.342945</td>
      <td>0.342945</td>
    </tr>
    <tr>
      <th>1997.0</th>
      <td>0.203162</td>
      <td>0.197638</td>
      <td>0.397577</td>
      <td>-0.058669</td>
      <td>0.434051</td>
      <td>0.434051</td>
      <td>0.580503</td>
      <td>0.313273</td>
      <td>0.388179</td>
      <td>0.188451</td>
      <td>...</td>
      <td>0.511296</td>
      <td>0.012817</td>
      <td>0.505579</td>
      <td>0.511296</td>
      <td>0.012817</td>
      <td>-0.547594</td>
      <td>0.074774</td>
      <td>-0.003518</td>
      <td>-0.219055</td>
      <td>-0.219055</td>
    </tr>
    <tr>
      <th>1998.0</th>
      <td>0.449263</td>
      <td>0.620285</td>
      <td>0.331003</td>
      <td>-0.710221</td>
      <td>0.669881</td>
      <td>0.669881</td>
      <td>0.355502</td>
      <td>0.194011</td>
      <td>0.340377</td>
      <td>0.401034</td>
      <td>...</td>
      <td>0.358588</td>
      <td>0.680764</td>
      <td>0.715996</td>
      <td>0.358588</td>
      <td>0.680764</td>
      <td>1.208492</td>
      <td>0.525448</td>
      <td>0.066342</td>
      <td>0.015942</td>
      <td>0.015942</td>
    </tr>
    <tr>
      <th>1999.0</th>
      <td>0.491018</td>
      <td>0.049518</td>
      <td>0.595795</td>
      <td>0.114631</td>
      <td>0.376434</td>
      <td>0.376434</td>
      <td>-0.012054</td>
      <td>0.322021</td>
      <td>0.886320</td>
      <td>0.350865</td>
      <td>...</td>
      <td>0.389719</td>
      <td>0.386616</td>
      <td>0.212224</td>
      <td>0.389719</td>
      <td>0.386616</td>
      <td>0.189435</td>
      <td>0.587975</td>
      <td>0.429542</td>
      <td>0.454576</td>
      <td>0.454576</td>
    </tr>
    <tr>
      <th>2000.0</th>
      <td>0.117906</td>
      <td>0.138573</td>
      <td>0.182085</td>
      <td>0.229045</td>
      <td>0.300098</td>
      <td>0.300098</td>
      <td>0.056609</td>
      <td>0.481311</td>
      <td>0.699468</td>
      <td>0.130622</td>
      <td>...</td>
      <td>0.627934</td>
      <td>0.029972</td>
      <td>0.138885</td>
      <td>0.627934</td>
      <td>0.029972</td>
      <td>-0.131674</td>
      <td>0.415641</td>
      <td>0.323995</td>
      <td>0.462285</td>
      <td>0.462285</td>
    </tr>
  </tbody>
</table>
<p>1000 rows × 104 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">temp</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">proxy</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">lonlat</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(1000, 336)
(1000, 104)
(440, 2)
</pre></div></div>
</div>
</section>
<section id="Graph-estimation">
<h2>Graph estimation<a class="headerlink" href="#Graph-estimation" title="Permalink to this heading">#</a></h2>
<p>In GraphEM, the selection of the covariance model used for inferring missing values is based on a <a class="reference external" href="http://ir.hit.edu.cn/~jguo/docs/notes/report-in-princeton-research.pdf">graph</a>. Two types of graphs are supported: 1. Neighborhood graphs 2. Empirical graphs (graphical lasso)</p>
</section>
<section id="1.-Neighborhood-graph-as-initial-guess">
<h2>1. Neighborhood graph as initial guess<a class="headerlink" href="#1.-Neighborhood-graph-as-initial-guess" title="Permalink to this heading">#</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g0</span> <span class="o">=</span> <span class="n">cfr</span><span class="o">.</span><span class="n">graphem</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">lonlat</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">temp</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">proxy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Let us define a neighborhood graph by including only points within a cutoff_radius <span class="math notranslate nohighlight">\(R\)</span> of each grid point or proxy locale. The location takes a bit of time the first time around as the matrix of mutual great- circle distances needs to be computed:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g0</span><span class="o">.</span><span class="n">neigh_adj</span><span class="p">(</span><span class="n">cutoff_radius</span><span class="o">=</span><span class="mi">1500</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Next we plot the temperature neighbors of a particular proxy to show what happened:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># index of proxy</span>
<span class="n">g0</span><span class="o">.</span><span class="n">plot_neighbors</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&lt;Figure size 288x288 with 1 Axes&gt;,
 &lt;GeoAxesSubplot:title={&#39;center&#39;:&#39;Neighbors of the target proxy (r=1500 km)&#39;}&gt;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_graphem-ppe-pages2k-debug_24_1.png" src="../_images/notebooks_graphem-ppe-pages2k-debug_24_1.png" />
</div>
</div>
<p>This, however, does not tell us the degree to which this proxy correlates to temperature at nerby grid points over the instrumental era. To do that, we use:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g0</span><span class="o">.</span><span class="n">plot_neighbors_corr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&lt;Figure size 360x360 with 2 Axes&gt;,
 &lt;GeoAxesSubplot:title={&#39;center&#39;:&#39;Neighbors of the target proxy (r=1500 km)&#39;}&gt;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_graphem-ppe-pages2k-debug_26_1.png" src="../_images/notebooks_graphem-ppe-pages2k-debug_26_1.png" />
</div>
</div>
<p>This can be instructive for small proxy networks, or for debugging purposes. For a bird’s eye view of the graph, we instead plot the adjacency matrix itself (dots indicate neighbors):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g0</span><span class="o">.</span><span class="n">adj_plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_graphem-ppe-pages2k-debug_28_0.png" src="../_images/notebooks_graphem-ppe-pages2k-debug_28_0.png" />
</div>
</div>
<p>By construction, proxies are assumed conditionally independent of each other, so the proxy-proxy part of the adjacency matrix is diagonal. The climate-climate is block-diagonal, reflecting the fact that nearby indices tend to reflect nearby gridpoints, and nearby gridpoints generally have similar climates*. There are discontinuities that happen when cycling through longitudes (0 –&gt; 360 back to 0), which show up as abrupt breaks in the graph. The climate-proxy part is less regular, reflecting
the fact that proxy locations are not uniformly spaced (unlike the grid points of the climate field). Notice how the overall matrix is very <strong>sparse</strong>: only a handful of of entries are non-zero (white is the main color on this plot). To be more precise, the <code class="docutils literal notranslate"><span class="pre">sparsity</span></code> property quantifies the fraction of non-zero entries:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g0</span><span class="o">.</span><span class="n">sparsity</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0.05653873489694385, 0.03345352564102564, 0.0]
</pre></div></div>
</div>
<p>We see that only a few % of the graph of the climate field and of the climate-proxy graph, have non-zero entries (the diagonal is excluded from this calculation, because a random variable is always conditionally dependent on itself; therefore, the proxy-proxy part of the graph has a sparsity of 0). This graph has achieved what we want: reducing the number of parameters to be estimated while computing the covariance matrix, which otherwise would be ill-conditioned. Will this suffice to yield a
good estimate? Or have we thrown out the rubber duckies with the bath water and jettisoned too much information? The control knob here is the cutoff-radius. Unfortunately, there is no theoretical criterion on how to choose an appropriate one. At a minimum, it should be larger than the largest spacing between nearby grid points (which tends to at the equator). At most, it should be the scale of the planet. That leaves quite some room in between. We will first carry out a preliminary
reconstruction, before refining the choice of cutoff-radius via a process called <a class="reference external" href="https://scikit-learn.org/stable/modules/cross_validation.html">cross-validation</a>.</p>
</section>
<section id="Preliminary-reconstruction">
<h2>Preliminary reconstruction<a class="headerlink" href="#Preliminary-reconstruction" title="Permalink to this heading">#</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>job.run_graphem<span class="o">?</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">Signature:</span> job<span class="ansi-blue-fg">.</span>run_graphem<span class="ansi-blue-fg">(</span>save_path<span class="ansi-blue-fg">,</span> verbose<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>fit_kws<span class="ansi-blue-fg">)</span>
<span class="ansi-red-fg">Docstring:</span>
Run the GraphEM solver, essentially the :py:meth: `GraphEM.solver.GraphEM.fit` method

Note that the arguments for :py:meth: `GraphEM.solver.GraphEM.fit` can be appended in the
argument list of this function directly. For instance, to pass a pre-calculated graph, use
`estimate_graph=False` and `graph=g.adj`, where `g` is the :py:`Graph` object.

Args:
    save_path (str): the path to save the fitting result
    verbose (bool, optional): print verbose information. Defaults to False.
    fit_kws (dict): the arguments for :py:meth: `GraphEM.solver.GraphEM.fit`

See also:
    cfr.graphem.solver.GraphEM.fit : fitting the GraphEM method
<span class="ansi-red-fg">File:</span>      ~/Documents/GitHub/cfr/cfr/reconjob.py
<span class="ansi-red-fg">Type:</span>      method

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[111]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="c1"># need to remove G.pkl if the previous run is problematic</span>
<span class="n">save_path</span> <span class="o">=</span> <span class="s1">&#39;./results/graphem-ppe-pages2k/G.pkl&#39;</span>
<span class="n">job</span><span class="o">.</span><span class="n">run_graphem</span><span class="p">(</span><span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">estimate_graph</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="n">g0</span><span class="o">.</span><span class="n">adj</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Using specified graph
Running GraphEM:

Iter     dXmis     rdXmis

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/julieneg/Documents/GitHub/cfr/cfr/graphem/solver.py:476: LinAlgWarning: Ill-conditioned matrix (rcond=9.98181e-35): result may not be accurate.
  beta_star = linalg.solve(W11_star,s12_star, assume_a=&#39;sym&#39;)
/Users/julieneg/Documents/GitHub/cfr/cfr/graphem/solver.py:476: LinAlgWarning: Ill-conditioned matrix (rcond=1.37597e-18): result may not be accurate.
  beta_star = linalg.solve(W11_star,s12_star, assume_a=&#39;sym&#39;)
/Users/julieneg/Documents/GitHub/cfr/cfr/graphem/solver.py:476: LinAlgWarning: Ill-conditioned matrix (rcond=1.07701e-50): result may not be accurate.
  beta_star = linalg.solve(W11_star,s12_star, assume_a=&#39;sym&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">LinAlgError</span>                               Traceback (most recent call last)
File <span class="ansi-green-fg">&lt;timed exec&gt;:3</span>, in <span class="ansi-cyan-fg">&lt;module&gt;</span>

File <span class="ansi-green-fg">~/Documents/GitHub/cfr/cfr/reconjob.py:803</span>, in <span class="ansi-cyan-fg">ReconJob.run_graphem</span><span class="ansi-blue-fg">(self, save_path, verbose, **fit_kws)</span>
<span class="ansi-green-intense-fg ansi-bold">    798</span> fit_kwargs <span style="color: rgb(98,98,98)">=</span> {
<span class="ansi-green-intense-fg ansi-bold">    799</span>     <span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">lonlat</span><span style="color: rgb(175,0,0)">&#39;</span>: <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>lonlat,
<span class="ansi-green-intense-fg ansi-bold">    800</span>     <span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">graph_method</span><span style="color: rgb(175,0,0)">&#39;</span>: <span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">neighborhood</span><span style="color: rgb(175,0,0)">&#39;</span>,
<span class="ansi-green-intense-fg ansi-bold">    801</span> }
<span class="ansi-green-intense-fg ansi-bold">    802</span> fit_kwargs<span style="color: rgb(98,98,98)">.</span>update(fit_kws)
<span class="ansi-green-fg">--&gt; 803</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">G</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">fit</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">temp</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">proxy</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">calib_idx</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg">fit_kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    804</span> pd<span style="color: rgb(98,98,98)">.</span>to_pickle(<span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>G, save_path)
<span class="ansi-green-intense-fg ansi-bold">    805</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> verbose: p_success(<span style="color: rgb(175,0,0)">f</span><span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">job.G created and saved to: </span><span class="ansi-bold" style="color: rgb(175,95,135)">{</span>save_path<span class="ansi-bold" style="color: rgb(175,95,135)">}</span><span style="color: rgb(175,0,0)">&#39;</span>)

File <span class="ansi-green-fg">~/Documents/GitHub/cfr/cfr/graphem/solver.py:137</span>, in <span class="ansi-cyan-fg">GraphEM.fit</span><span class="ansi-blue-fg">(self, temp, proxy, calib, graph, lonlat, sp_TT, sp_TP, sp_PP, N_graph, C0, M0, maxit, bootstrap, N_boot, cutoff_radius, graph_method, estimate_graph, save_graphs)</span>
<span class="ansi-green-intense-fg ansi-bold">    134</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-intense-fg ansi-bold">    135</span>         <span style="color: rgb(0,135,0)">print</span>(<span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">Using specified graph</span><span style="color: rgb(175,0,0)">&#34;</span>)
<span class="ansi-green-fg">--&gt; 137</span> [X,C,M] <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">EM</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">X</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">graph</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">C0</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">M0</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">maxit</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    138</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>temp_r <span style="color: rgb(98,98,98)">=</span> X[:,ind_T]
<span class="ansi-green-intense-fg ansi-bold">    139</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>proxy_r <span style="color: rgb(98,98,98)">=</span> X[:,ind_P]

File <span class="ansi-green-fg">~/Documents/GitHub/cfr/cfr/graphem/solver.py:254</span>, in <span class="ansi-cyan-fg">GraphEM.EM</span><span class="ansi-blue-fg">(self, X, graph, C0, M0, maxit, use_iridge)</span>
<span class="ansi-green-intense-fg ansi-bold">    252</span>         C <span style="color: rgb(98,98,98)">=</span> (X<span style="color: rgb(98,98,98)">.</span>T<span style="color: rgb(98,98,98)">.</span>dot(X) <span style="color: rgb(98,98,98)">+</span> CovRes)<span style="color: rgb(98,98,98)">/</span>(n<span style="color: rgb(98,98,98)">-</span><span style="color: rgb(98,98,98)">1</span>)
<span class="ansi-green-intense-fg ansi-bold">    253</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">--&gt; 254</span>         C <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">fit_Sigma</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">np</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">cov</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">X</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">T</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">+</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">CovRes</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">/</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">n</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">-</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">1</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">graph</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    255</span>     <span style="color: rgb(0,135,0)">print</span>(<span style="color: rgb(175,0,0)">&#34;</span><span class="ansi-bold" style="color: rgb(175,95,135)">%1.3d</span><span style="color: rgb(175,0,0)">     </span><span class="ansi-bold" style="color: rgb(175,95,135)">%1.4f</span><span style="color: rgb(175,0,0)">     </span><span class="ansi-bold" style="color: rgb(175,95,135)">%1.4f</span><span style="color: rgb(175,0,0)">&#34;</span> <span style="color: rgb(98,98,98)">%</span> (it, dXmis, rdXmis))
<span class="ansi-green-intense-fg ansi-bold">    256</span> X <span style="color: rgb(98,98,98)">=</span> X <span style="color: rgb(98,98,98)">+</span> M

File <span class="ansi-green-fg">~/Documents/GitHub/cfr/cfr/graphem/solver.py:276</span>, in <span class="ansi-cyan-fg">GraphEM.fit_Sigma</span><span class="ansi-blue-fg">(self, S, graph)</span>
<span class="ansi-green-intense-fg ansi-bold">    260</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span> <span style="color: rgb(0,0,255)">fit_Sigma</span>(<span style="color: rgb(0,135,0)">self</span>, S, graph):
<span class="ansi-green-intense-fg ansi-bold">    261</span>     <span style="color: rgb(175,0,0)">&#39;&#39;&#39; Estimates the covariance matrix of the field using the provided graph</span>
<span class="ansi-green-intense-fg ansi-bold">    262</span> <span style="color: rgb(175,0,0)">    </span>
<span class="ansi-green-intense-fg ansi-bold">    263</span> <span style="color: rgb(175,0,0)">    Parameters</span>
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-intense-fg ansi-bold">    274</span> <span style="color: rgb(175,0,0)">    </span>
<span class="ansi-green-intense-fg ansi-bold">    275</span> <span style="color: rgb(175,0,0)">    &#39;&#39;&#39;</span>
<span class="ansi-green-fg">--&gt; 276</span>     C <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">fitggm</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">S</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">graph</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    277</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> C

File <span class="ansi-green-fg">~/Documents/GitHub/cfr/cfr/graphem/solver.py:476</span>, in <span class="ansi-cyan-fg">fitggm</span><span class="ansi-blue-fg">(S, graph, tol, maxit)</span>
<span class="ansi-green-intense-fg ansi-bold">    473</span> s12_star <span style="color: rgb(98,98,98)">=</span> S[indices,i1]
<span class="ansi-green-intense-fg ansi-bold">    474</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(98,98,98)">~</span>np<span style="color: rgb(98,98,98)">.</span>all(ind<span style="color: rgb(98,98,98)">==</span><span style="color: rgb(98,98,98)">0</span>):
<span class="ansi-green-intense-fg ansi-bold">    475</span>     <span style="color: rgb(95,135,135)">#beta_star = np.linalg.solve(W11_star,s12_star)</span>
<span class="ansi-green-fg">--&gt; 476</span>     beta_star <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">linalg</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">solve</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">W11_star</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg">s12_star</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">assume_a</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#39;</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">sym</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#39;</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    477</span>     beta[i1,:] <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(98,98,98)">0</span>
<span class="ansi-green-intense-fg ansi-bold">    478</span>     beta[i1,indices] <span style="color: rgb(98,98,98)">=</span> beta_star

File <span class="ansi-green-fg">~/opt/miniconda3/envs/cfr-env/lib/python3.9/site-packages/scipy/linalg/_basic.py:244</span>, in <span class="ansi-cyan-fg">solve</span><span class="ansi-blue-fg">(a, b, sym_pos, lower, overwrite_a, overwrite_b, debug, check_finite, assume_a, transposed)</span>
<span class="ansi-green-intense-fg ansi-bold">    239</span>     lwork <span style="color: rgb(98,98,98)">=</span> _compute_lwork(sysv_lw, n, lower)
<span class="ansi-green-intense-fg ansi-bold">    240</span>     lu, ipvt, x, info <span style="color: rgb(98,98,98)">=</span> sysv(a1, b1, lwork<span style="color: rgb(98,98,98)">=</span>lwork,
<span class="ansi-green-intense-fg ansi-bold">    241</span>                              lower<span style="color: rgb(98,98,98)">=</span>lower,
<span class="ansi-green-intense-fg ansi-bold">    242</span>                              overwrite_a<span style="color: rgb(98,98,98)">=</span>overwrite_a,
<span class="ansi-green-intense-fg ansi-bold">    243</span>                              overwrite_b<span style="color: rgb(98,98,98)">=</span>overwrite_b)
<span class="ansi-green-fg">--&gt; 244</span>     <span class="ansi-yellow-bg">_solve_check</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">n</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">info</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    245</span>     rcond, info <span style="color: rgb(98,98,98)">=</span> sycon(lu, ipvt, anorm)
<span class="ansi-green-intense-fg ansi-bold">    246</span> <span style="color: rgb(95,135,135)"># Positive definite case &#39;posv&#39;</span>
<span class="ansi-green-intense-fg ansi-bold">    247</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:

File <span class="ansi-green-fg">~/opt/miniconda3/envs/cfr-env/lib/python3.9/site-packages/scipy/linalg/_basic.py:29</span>, in <span class="ansi-cyan-fg">_solve_check</span><span class="ansi-blue-fg">(n, info, lamch, rcond)</span>
<span class="ansi-green-intense-fg ansi-bold">     26</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> <span class="ansi-bold" style="color: rgb(215,95,95)">ValueError</span>(<span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">LAPACK reported an illegal value in </span><span class="ansi-bold" style="color: rgb(175,95,135)">{}</span><span style="color: rgb(175,0,0)">-th argument</span><span style="color: rgb(175,0,0)">&#39;</span>
<span class="ansi-green-intense-fg ansi-bold">     27</span>                      <span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">.</span><span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(98,98,98)">.</span>format(<span style="color: rgb(98,98,98)">-</span>info))
<span class="ansi-green-intense-fg ansi-bold">     28</span> <span class="ansi-bold" style="color: rgb(0,135,0)">elif</span> <span style="color: rgb(98,98,98)">0</span> <span style="color: rgb(98,98,98)">&lt;</span> info:
<span class="ansi-green-fg">---&gt; 29</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> LinAlgError(<span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">Matrix is singular.</span><span style="color: rgb(175,0,0)">&#39;</span>)
<span class="ansi-green-intense-fg ansi-bold">     31</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> lamch <span class="ansi-bold" style="color: rgb(175,0,255)">is</span> <span class="ansi-bold" style="color: rgb(0,135,0)">None</span>:
<span class="ansi-green-intense-fg ansi-bold">     32</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span>

<span class="ansi-red-fg">LinAlgError</span>: Matrix is singular.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_graphem-ppe-pages2k-debug_33_3.png" src="../_images/notebooks_graphem-ppe-pages2k-debug_33_3.png" />
</div>
</div>
<p>What an error message ! The algorithm wasn’t able to run a single iteration. Indeed, it failed at the first calculation. Is it broken?</p>
</section>
</section>
<section id="Bug-Hunting">
<h1>Bug Hunting<a class="headerlink" href="#Bug-Hunting" title="Permalink to this heading">#</a></h1>
<p>The key to this error message is to realize that a subset of a correlation matrix called W11_star is singular; this happens most often because predictors are colinear (i.e. columns of the data matrix are the same, so the information is redundant, which chokes up this algorithm). This situation is an artifact of this pseudoproxy case with dream-like SNR, and is extremely unlikely to arise with real proxies. Nevertheless, we need to deal with it numerically to ensure a solution.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[112]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">proxy</span><span class="o">.</span><span class="n">T</span><span class="p">),</span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># exclude diagonal and lower triangle (matrix is symmatric --&gt; double counting)</span>
<span class="n">R</span><span class="p">[</span><span class="n">R</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">mappable</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mappable</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">orientation</span> <span class="o">=</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Proxy correlation matrix&#39;</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Correlation distribution&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$r$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[112]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 0, &#39;$r$&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_graphem-ppe-pages2k-debug_36_1.png" src="../_images/notebooks_graphem-ppe-pages2k-debug_36_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[137]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">di</span><span class="p">,</span><span class="n">dj</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">R</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[137]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([  1,   1,   2,   4,   4,   4,   5,   5,   6,   6,   6,  12,  13,
        13,  15,  18,  19,  21,  22,  22,  23,  25,  26,  28,  29,  29,
        30,  31,  33,  36,  39,  40,  43,  43,  43,  43,  43,  45,  47,
        47,  49,  51,  51,  52,  55,  58,  59,  68,  70,  72,  78,  78,
        79,  83,  88,  90,  90,  90,  90,  91,  91,  91,  92,  92,  94,
        95, 102])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[145]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">npairs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">R</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There are </span><span class="si">{:3.2f}</span><span class="s2"> </span><span class="si">% d</span><span class="s2">uplicate pairs among this proxy set&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">di</span><span class="p">)</span><span class="o">/</span><span class="n">npairs</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
There are 1.25 % duplicate pairs among this proxy set
</pre></div></div>
</div>
<p>Indeed we see that about 1% of pairs have duplicate values. They need to be removed if we are to conduct a sucessful reconstruction. For this, we can rerun <code class="docutils literal notranslate"><span class="pre">prep_graphem</span></code> by setting the flag <code class="docutils literal notranslate"><span class="pre">remove_duplicates</span> <span class="pre">=</span> <span class="pre">True</span></code>:</p>
</section>


                </article>
              

              
              
                <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">A Pseudoproxy Experiment with GraphEM and pseudoPAGES2k</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Data-Preparation">Data Preparation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Graph-estimation">Graph estimation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#1.-Neighborhood-graph-as-initial-guess">1. Neighborhood graph as initial guess</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Preliminary-reconstruction">Preliminary reconstruction</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#Bug-Hunting">Bug Hunting</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            <div class="bd-footer-content__inner">
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023, Feng Zhu, Julien Emile-Geay.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div></div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>